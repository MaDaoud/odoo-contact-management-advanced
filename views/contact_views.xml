<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <!-- ===== Contact Form View ===== -->
        <record id="view_contact_form" model="ir.ui.view">
            <field name="name">mon_module.contact.form</field>
            <field name="model">mon_module.contact</field>
            <field name="arch" type="xml">
                <form string="Contact">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="email"/>
                            <field name="phone"/>
                            <field name="category_id"/>
                            <field name="related_contacts" widget="many2many_tags"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- ===== Contact List View ===== -->
        <record id="view_contact_list" model="ir.ui.view">
            <field name="name">mon_module.contact.list</field>
            <field name="model">mon_module.contact</field>
            <field name="arch" type="xml">
                <list string="Contacts">
                    <field name="name"/>
                    <field name="email"/>
                    <field name="phone"/>
                    <field name="category_id"/>
                </list>
            </field>
        </record>

        <!-- ===== Contact Search View ===== -->
        <record id="view_contact_search" model="ir.ui.view">
            <field name="name">mon_module.contact.search</field>
            <field name="model">mon_module.contact</field>
            <field name="arch" type="xml">
                <search string="Recherche Contacts">

                    <field name="name"/>
                    <field name="email"/>
                    <field name="phone"/>
                    <field name="category_id"/>

                    <!-- Filtre dynamique -->
                    <filter name="no_category"
                            string="Sans catégorie"
                            domain="[('category_id','=',False)]"/>

                    <separator/>

                    <!-- Group by -->
                    <filter name="group_by_category"
                            string="Grouper par catégorie"
                            context="{'group_by':'category_id'}"/>

                </search>
            </field>
        </record>

        <!-- ===== Category Form View ===== -->
        <record id="view_category_form" model="ir.ui.view">
            <field name="name">mon_module.category.form</field>
            <field name="model">mon_module.category</field>
            <field name="arch" type="xml">
                <form string="Catégorie">
                    <sheet>
                        <group>
                            <field name="name"/>
                            <field name="description"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- ===== Category List View ===== -->
        <record id="view_category_list" model="ir.ui.view">
            <field name="name">mon_module.category.list</field>
            <field name="model">mon_module.category</field>
            <field name="arch" type="xml">
                <list string="Catégories">
                    <field name="name"/>
                    <field name="description"/>
                </list>
            </field>
        </record>

        <!-- ===== Category Kanban View ===== -->
        <record id="view_category_kanban" model="ir.ui.view">
            <field name="name">mon_module.category.kanban</field>
            <field name="model">mon_module.category</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="name"/>
                    <field name="contact_ids"/>

                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_card">
                                <strong>
                                    <t t-esc="record.name.value"/>
                                </strong>
                                <div>
                                    <t t-esc="record.contact_ids.value.length"/> contacts
                                </div>
                            </div>
                        </t>
                    </templates>

                </kanban>
            </field>
        </record>

        <!-- ===== Actions ===== -->
        <record id="action_gestion_contacts" model="ir.actions.act_window">
            <field name="name">Contacts</field>
            <field name="res_model">mon_module.contact</field>
            <field name="view_mode">list,form</field>
            <field name="search_view_id" ref="view_contact_search"/>
        </record>

        <record id="action_gestion_categories" model="ir.actions.act_window">
            <field name="name">Catégories</field>
            <field name="res_model">mon_module.category</field>
            <field name="view_mode">list,form</field>
        </record>

        <record id="action_category_kanban" model="ir.actions.act_window">
            <field name="name">Tableau de bord</field>
            <field name="res_model">mon_module.category</field>
            <field name="view_mode">kanban,form</field>
        </record>

        <!-- ===== Menu ===== -->
        <menuitem id="menu_gestion_contacts_root" name="Gestion de contacts"/>

        <menuitem id="menu_gestion_contacts"
                  parent="menu_gestion_contacts_root"
                  action="action_gestion_contacts"
                  name="Contacts"
                  sequence="10"/>

        <menuitem id="menu_gestion_categories"
                  parent="menu_gestion_contacts_root"
                  action="action_gestion_categories"
                  name="Catégories"
                  sequence="20"/>

        <menuitem id="menu_category_kanban"
                  parent="menu_gestion_contacts_root"
                  action="action_category_kanban"
                  name="Tableau de bord"
                  sequence="30"/>

    </data>
</odoo>
